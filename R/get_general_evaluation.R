# WARNING - Generated by {fusen} from dev/flat_data_contamination.Rmd: do not edit by hand # nolint: line_length_linter.

#' Title
#' 
#' Description
#' 
#' @param family character Family folder name
#' @param suffix character If necessary, a suffix for the output .xlsx file name
#' @param res_family_trends tibble 
#' @param res_kruskal tibble
#'
#' @return save a .xlsx in the folder "../inst/results/data_contam/"
#' 
#' @export
#' @examples
#' # get_general_evaluation()
get_general_evaluation <- function(family, 
                                   suffix = "",
                                   res_family_trends,
                                   res_kruskal) {
  
  # Last trend
  short_last_trend_family <- res_family_trends |>
    rename(short_last_trend = symbol) |>
    select(-last_year, -last_year, -last_resultat)
  
  # Long term evolution
  long_term_family <- res_kruskal |>
    mutate(
      status = case_when(
        median_2 >= 0 & median_2 < 50 ~ "blue",
        median_2 >= 50 & median_2 < 100 ~ "green",
        median_2 >= 100 & median_2 < 150 ~ "yellow",
        median_2 >= 150 & median_2 < 300 ~ "orange",
        median_2 >= 300 & median_2 < 500 ~ "red",
        median_2 >= 500 ~ "black"
      )
    ) |>
    rename(long_term_trend = trend) |>
    select(-max_value, -y_pos)
  
  general_eval_family <- full_join(short_last_trend_family, long_term_family)

  general_eval_family_table <- general_eval_family  |>
    unite(col = eval, long_term_trend, short_last_trend, status, sep = "  ") |>
    select(ESTUARY, PARAMETRE_LIBELLE, eval) |> 
    arrange(ESTUARY) |>
    pivot_wider(names_from = ESTUARY, values_from = eval) 
  
  writexl::write_xlsx(x = list(general_eval_family_table, general_eval_family), 
                    path = paste0("../inst/results/data_contam/", family, "/general_eval_", family, suffix, ".xlsx"))
}
